<?xml version="1.0" encoding="utf-8"?>
<components:PopupBox xmlns:fx="http://ns.adobe.com/mxml/2009"
					 xmlns:s="library://ns.adobe.com/flex/spark"
					 xmlns:mx="library://ns.adobe.com/flex/mx"
					 xmlns:components="com.pamakids.components.*"
					 title="登录系统"
					 creationComplete="popupbox1_creationCompleteHandler(event)">

	<fx:Script>
		<![CDATA[
			import com.pamakids.components.PAlert;
			import com.pamakids.models.ResultVO;
			import com.pamakids.services.ServiceBase;

			import mx.events.FlexEvent;

			import spark.skins.mobile.TextInputSkin;

			import controllers.API;
			private var api:API;

			protected function button1_clickHandler(event:MouseEvent):void
			{
				loginBtn.enabled=false;
				API.instance.login(username.text, password.text, function(vo:ResultVO):void
				{
					if (vo.status)
					{
						ServiceBase.id=vo.results.id + '';
						api.config.username=username.text;
						api.config.password=password.text;
						api.config.id=ServiceBase.id;
//						so.data.broadcasts = vo.results.broadcasts;
						Log.info('Frist Login---true---username:' + username.text + '----password:' + password.text);
						api.saveConfig();
						Log.info('LoginInfo save');
						close();
					}
					else
					{
						PAlert.show("登陆出错，请再试一次\n" + vo.errorResult);
					}
					loginBtn.enabled=true;
				});
			}

			protected function popupbox1_creationCompleteHandler(event:FlexEvent):void
			{
				api=API.instance;
				skin["close"].visible=false;
				var config:Object={};
//				config.username='武汉宜家:武汉宜家';
//				config.password="721793";
				username.text=config.username;
				password.text=config.password;
			}
		]]>
	</fx:Script>

	<components:layout>
		<s:VerticalLayout horizontalAlign="center"
						  paddingLeft="40"
						  paddingRight="40"
						  paddingBottom="20"
						  paddingTop="30"
						  gap="10"/>
	</components:layout>

	<s:TextInput id="username"
				 prompt="用户名"
				 skinClass="spark.skins.mobile.TextInputSkin"/>
	<s:TextInput id="password"
				 prompt="密码"
				 skinClass="spark.skins.mobile.TextInputSkin"/>
	<s:Spacer height="10"/>
	<s:Button label="登录"
			  id="loginBtn"
			  skinClass="skins.buttons.LoginButtonSkin"
			  click="button1_clickHandler(event)"/>
</components:PopupBox>
